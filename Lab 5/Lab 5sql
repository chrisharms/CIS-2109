create view vendors_with_invoices as
select *
from vendors
where vendor_id in (select vendor_id
                    from invoices);
                
insert into vendors_with_invoices(vendor_id,vendor_name,vendor_city,vendor_state,vendor_zip_code,default_terms_id,default_account_number) 
values (150,'UK Postal Service','Madison','WI','53707',1,552);
commit;

drop view vendors_with_invoices;
create view vendors_with_invoices as
select *
from vendors
where vendor_id in (select vendor_id
                    from invoices)
with check option;
insert into vendors_with_invoices(vendor_id,vendor_name,vendor_city,vendor_state,vendor_zip_code,default_terms_id,default_account_number) 
values (150,'UK Postal Service','Madison','WI','53707',1,552);
commit;

create table Customer_Statistics (
        customer_id         NUMBER PRIMARY KEY,
        Number_of_Orders    NUMBER,
        Number_of_Items     NUMBER);

select c.customer_id, count(o.order_id), NVL(sum(d.order_qty),0)
from customers c left outer join orders o
on c.customer_id = o.customer_id
left outer join order_details d
on o.order_id = d.order_id 
group by c.customer_id;

insert into customer_statistics
    select c.customer_id as customer_id, count(o.order_id) as Number_of_Orders, NVL(sum(d.order_qty),0) as Number_of_items
    from customers c left outer join orders o
    on c.customer_id = o.customer_id
    left outer join order_details d
    on o.order_id = d.order_id 
    group by c.customer_id;
commit;

alter table customer_statistics
add (Customer_Status varchar2(20));
commit;

update customer_statistics
set Customer_status = 'ok'
where number_of_orders = 0 or number_of_orders=1;
commit;
update customer_statistics
set customer_status = 'good'
where number_of_orders >=2;
commit;
update customer_statistics
set customer_status = 'great'
where number_of_orders > 5 and number_of_items >5;
commit;

delete from customer_statistics
where number_of_orders=0;

alter table customer_statistics
modify number_of_items not null;
commit;

alter table customer_statistics
modify number_of_orders default 0;
commit;

truncate table customer_statistics;
commit;

drop table customer_statistics;
commit;